> 본 문서는 전자정부 표준프레임워크 QuickStart[(링크)](http://www.yes24.com/Product/Goods/66372749) 책을 공부한 내용을 기술하였습니다.

Chapter 04. Maven
==

Maven?
--
메이븐은 소프트웨어를 개발할 때 반복되는 작업을 자동화하는 빌드 도구로, 자바 프로젝트의 빌드를 자동화 해주는 빌드 툴이다. 쉽게 말해 자바 소스를 컴파일하고 패키지해서 서비스 하는 일을 자동화 해주는 것이다.

![image](https://media.discordapp.net/attachments/633251365434687491/667360850142691329/unknown.png)

> __그림__: Maven logo

Maven의 구성
--
메이븐은 일반적으로 다음과 같은 5개의 흐름으로 구성된다.
- Build
    - 소스 코드를 컴파일
    - 패키지 생성을 위한 바이너리를 생성
- Package
    - 배포 가능한 파일, exe 등을 생성

- Test
    - 단위 테스트(Unit test) 등을 실행
    - 빌드 결과 점검

- Report
    - 빌드/패키지/테스트 결과를 정리하고, 빌드 수행 리포트를 생성
- Release
    - 빌드 후, 생성된 아키팩트(artifact)를 로컬 혹은 원격 저장소에 저장(배포)  

##### *artifact: 산출물의 의미로, 각종 설계 문서, 유스케이스, UML, 소스코드 등을 비롯한 생성된 라이브러리와 실행파일 모두가 여기에 속한다. 

![image](https://t1.daumcdn.net/cfile/tistory/999BF0365A53402124?download)
> __그림__: Maven의 전체 구조

Maven의 특징
--
1. __정형화된 구조와 절차를 제공__  
: 메이븐은 컴파일, 패키징, 테스트 등의 작업 프로세스를 정형화하고 이를 준수하도록 강제한다. 따라서, 모든 프로젝트에 일관된 디렉토리 구조와 빌드 프로세스를 유지할 수 있게 되어 표준에 따른 개발이 가능해진다.

2. __디펜던시 라이브러리 해결을 자동화__  
: 애플리케이션을 실행하기 위해 필요한 라이브러리들과 그 라이브러리들이 필요로하는 라이브러리 등의 의존성 혹은 종속성을 __라이브러리 디펜던시__ 라고 한다. 

3. __라이브러리 관리가 용이__  
: 메이븐에서는 라이브러리 전용 저장소를 제공하므로, 통합 관리가 가능해진다. (일반적으로 프로젝트 진행 시, 사용되는 라이브러리는 형상 관리 도구에서 관리한다.)

4. __라이프 사이클을 가짐__  
: 메이븐은 라이프 사이클을 가지고 있어 라이프 사이클에 따라 연속적으로 단계를 실행한다.

5. __다양한 플러그인을 활용 가능__

Plugin과 Goal
--
메이븐 플러그인은 한 개 이상의 골(Goal)들의 집합입니다. 골(Goal)은 일종의 `실행 단위`인 셈이죠.  
메이븐 코어는 몇 개의 XML 문서들이 해석되고, 어떤 라이프 사이클을 관리하는지, 어떤 플러그인들이 어떻게 작동하는지 알지 못합니다. 대부분의 책임을 메이븐 플러그인들에게 위임하도록 설계되었습니다. 

플러그인들은 라이프 사이클에 영향을 미치고 플로그인이 가진 골을 실행시킬 수 있도록 허용합니다. 메이븐 내의 동작들은 플러그인 골에서 일어나는데, 메이븐의 많은 기능들은 플러그인들로 구현되어 있고, 이러한 플러그인들은 메이븐의 저장소에서 찾아서 사용할 수 있습니다. 

![image](https://2.bp.blogspot.com/-VN_nhvgirQM/XBhX8XI7AbI/AAAAAAAAAGw/2QvMIhv6N8sHUv2TsnHftwHLpfqIo_52wCLcBGAs/s1600/Screen%2BShot%2B2018-12-18%2Bat%2B11.13.53%2BAM.png)
> __그림__: 메이븐의 플러그인과 골(Goals)

Life cycle
--
메이븐은 `빌드 라이프 사이클`이라고 하는 절차를 가지는데, 이는 프로젝트 빌드에 관련된 각 __단계(Phases)__ 의 순서를 의미합니다. 메이븐은 여러 다른 라이프 사이클을 지원하지만 기본 라이프 사이클을 많이 사용합니다.

플러그인의 골(goal)은 라이프 사이클 단계에 포함될 수 있습니다. 각 단계에는 골이 없을 수도 있고 다수의 골을 가질 수 도 있습니다. 

![image](https://3.bp.blogspot.com/-3Ie9w_rVgFA/XDb-j1244BI/AAAAAAAAA38/0A-G-PQr9848tG_DM_OQlvxvE0Uicow9ACLcBGAs/s1600/Screen%2BShot%2B2019-01-10%2Bat%2B5.11.51%2BPM.png)

> __그림__: 메이븐의 라이프 사이클

- __기본 라이프사이클__

소스코드 컴파일, 테스트, 압축, 배포와 같은 일련의 작업을 모두 실행하는 라이프 사이클입니다.  

compile은 소스코드를 컴파일하는 페이즈이고 test는 JUnit, TestNG와 같은 단위 테스트 프레임워크로 단위테스트를 합니다.  

package는 단위테스트가 성공하면 pom.xml의 <package/>앨리먼트 값(war,jar,ear 등)에 따라 압축합니다.  

install은 로컬저장소에 압축한 파일을 배포하는 페이즈입니다.  

deploy는 원격저장소로 압축한 파일을 배포하는 페이즈이다.

- __clean 라이프사이클__

clean페이즈를 이용하여 실행하는데, clean페이즈를 실행하면 메이븐 빌드가 통하여 target디렉토리에 생성된 모든 산출물을 삭제하여 배포전에 이전에 있었던 내용을 겹치지 않게 제거해주는 일을 합니다. 

- __site 라이프사이클__

site와 site-deploy 페이즈를 이용하여 실행하고 메이븐 설정파일의 정보를 활용하여 프로젝트에 대한 문서 사이트를 생성할 수 있도록 지원합니다.

mvn site를 실행하면 메이븐에 설정되어 있는 기본설정, 플러그인의 설정에 따라 target/site 디렉토리에 문서사이트를 생성합니다. 

site 페이즈는 문서사이트를 생성하고 site-deploy 페이즈는 생성한 문서사이트를 설정되어 있는 서버에 배포하는 역할을 합니다. 

![image](https://t1.daumcdn.net/cfile/tistory/234B653752CBC03A29)
> __그림__: 메이븐 기본 페이즈(Phases)와 골(goal)의 관계 

Maven 저장소
-- 
메이븐의 저장소는 3가지로 분류할 수 있다.

1. 중앙 저장소
2. 원격 저장소
3. 로컬 저장소
    
- 중앙 저장소: 오픈 소스 라이브러리, 메이븐 플러그인, 메이븐 아키타입을 관리하는 저장소. 메이븐 2.0의 중앙 저장소의 URL은 http://repo1.maven.rog/maven2/이다. 중앙 저장소는 개발자가 임의로 라이브러리를 배포할 수 없다.

- 원격 저장소: 중앙 저장소에 없는 라이브러리를 한 곳에 모아두기 위하여 별도의 메이븐 저장소를 설치해 관리하는 것이 가능한데 이것이 원격 저장소이다. 원격 저장소는 회사내에서만 사용하기 위한 용도로 많이 사용된다.

![image](https://media.discordapp.net/attachments/633251365434687491/667372124289105930/unknown.png)
> __그림__: 원격 저장소의 구조

- 로컬 저장소: 로컬 저장소는 메이븐을 빌드할 때 다운로드하는 라이브러리이다. 플러그인을 관리하는 개발자 PC의 저장소이다. 

![image](https://media.discordapp.net/attachments/633251365434687491/667372288248643597/unknown.png)
> __그림__: 로컬 저장소의 구조

의존성 관리
--

- Pom.xml 파일안에 `<dependencies>`요소를 사용하여 표현
- Pom에 있는 프로젝트의 의존성 정보를 기반으로 의존성을 분석
    - 로컬 저장소에서 의존성 정보를 기반으로 확인
    - 원격 저장소 리스트에서 의존성 확인
    - 의존성 확인 실패시, 에러 보고

Pom.xml
--

Pom.xml 파일은 메이븐 프로젝트 생성 시, 기본으로 생성되는 파일로, 프로젝트 관리 및 빌드에 필요한 환경 설절과 의존성 관리 등, 프로젝트 정보들을 담고 있습니다. 

Pom.xml 파일은 프로젝트의 세부 메타 데이터 정보를 포함하여 크게 10개의 항목으로 구성됩니다.

- General Information: 프로젝트 이름, 설명, 버전 정보 등
- Organization: 프로젝트 조직 정보(이름, 홈페이지, URL 등)
- Project Team and Collaborations tools: 형상관리 서버, 이슈 트래커, 통합 빌드 서버 정보 등
- Build: 인코딩 정보 등 빌드 라이프 사이클 환경 설정 
- Repoting: 리포트 생성 기능 설정
- Dependencies: 프로젝트에서 사용하는 라이브러리를 선언하여 Build Path에 포함
- Repositories: 라이브러리 저장소 위치 설정
- Destribution Management: 배포 환경 설정
- Profiles: 빌드 설정
- Properties: 프로젝트 속성

![image](https://media.discordapp.net/attachments/633251365434687491/667373926241927179/unknown.png?width=756&height=284)

> __그림__: Pom.xml의 구조

dependency 추가
--
개발자는 프로젝트에 사용할 라이브러리를 Pom.xml에 dependency로 정의만 해두면 메이븐이 repository에서 검색하여 자동으로 추가해준다. 심지어 참조하고있는 library까지 모두 찾아서 추가해준다. 이것을 __의존성 전이__ 라고 한다.

```xml
<dependencies>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>3.8.1</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

> __코드__: junit dependency 추가 예제

### 필수 선언 항목

여기서, 필수 선언 항목이 __groupId__, __artifactId__, __version__ 3가지이다. 

- groupId: 부분적인 프로젝트나 조직에서 라이브러리 집합을 식별하기 위함
- artifactId: 프로젝트의 실제 이름
- version: 선언한 디펜던시 아티팩트의 버전

### Scope

scope는 라이브러리 간의 충돌이 일어나는 경우를 방지하기위해 명시하는 것으로 디펜던시 하위에 포함되는 항목이다. 해당 디펜던시가 포함되는 범위에 대한 타입을 뜻한다.  
compile, provided, runtime, test, system 등이 있다.

- compile: 기본값으로 모든 클래스 패스에서 사용가능
- provided: 컴파일과 유사하나 패키지에는 포함되지 않는다. 
- Runtime: 컴파일러가 아닌 런타임 시에 사용.
- Test: 테스트 시에 사용
- System: provide와 유사하나, 개발자가 직접 JAR 파일(하나의 애플리케이션이 가능하도록 java 파일을 압축하고 지원)을 제공해야 하고, 저장소에서 지정한 dependency를 찾지 않는다.
